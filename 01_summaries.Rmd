---
title: "01_summaries"
author: "Puvvula"
date: "2023-03-02"
output: pdf_document
---

```{r}
library(tidyverse)
library(janitor)
library(skimr)
library(readr)
library(reshape2)
library(kableExtra)
library(gridExtra)
```

```{r}
#Urine PAH concentration (log transformed and creatinine adjusted) + covariates
mom_pah<- read_csv("~/Documents/MWAS_home/pj_dat/mom_pah.csv") |>
  clean_names()

baby_pah<- read_csv("~/Documents/MWAS_home/pj_dat/baby_pah.csv") |>
  clean_names()

covar <-read_csv("~/Documents/MWAS_home/pj_dat/covar.csv") |>
  clean_names()

covar[c(11:15)]<- lapply(covar[c(11:15)], as.numeric)

#####################################################################
#join mom and baby PAH
pah<- full_join(mom_pah, baby_pah[2:11], by="group")

pah_fin<- full_join(pah, covar[-c(1,7)], by="group")

write_csv(pah_fin, "~/Documents/MWAS_home/pj_dat/pah_fin.csv")
```

summary table
```{r}
dat_wide<- read_csv("~/Documents/MWAS_home/pj_dat/pah_fin.csv") |>
  select(c(1,3:20)) |>
  pivot_longer(!participant_id, names_to = "measure", values_to = "value") |>
  mutate(mom_baby = substr(measure, 1, 1))

geomean <- function(x, na.rm = T, trim = 0, ...) 
  { exp(mean(log(x, ...), na.rm = na.rm, trim = trim, ...)) }
geosd <- function(x, na.rm = T, ...)
{ exp(sd(log(x, ...), na.rm = na.rm, ...)) }

dat_summ<- dat_wide |> 
    group_by(measure, mom_baby) |>
    summarise(geometric_mean = geomean(value), geometric_SD = geosd(value),
              median = median((value), na.rm = T), q25 = quantile(value, .25, na.rm=T),
              q75 = quantile(value, .75, na.rm=T)) |>
    mutate_if(is.numeric, round, 3)

pah_tab<- kable(dat_summ, longtable=T, booktabs=T, caption = "PAH - Data summary") |>
  kable_styling(latex_options = c("repeat_header"))

write_csv(dat_summ, "~/Documents/MWAS_home/pj_dat/pah_summary.csv")
```

correlation b/w chemicals mom and baby
```{r}
dat<- read_csv("~/Documents/MWAS_home/pj_dat/pah_fin.csv")

cormat<- round(x=cor(dat[3:20], method = "spearman", 
                     use= "complete.obs"), digits=2) |>
  melt() |> clean_names()

ggplot(cormat, aes(x=var2, y=var1, fill=value)) +
  geom_tile(color="white")+
  scale_fill_gradient2(low="red", high="blue", mid="white",
                       midpoint=0,
                       limit=c(-1,1), space= "Lab",
                      name="Spearman Correlation")+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, size = 12, hjust = 1),
        axis.text.y = element_text(angle = 0, vjust = 1, size = 12, hjust = 1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom", legend.box = "horizontal")+
  coord_fixed()
```

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

